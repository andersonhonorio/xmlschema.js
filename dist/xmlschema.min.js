function XsSimpleTypeValidator(a,b){this.xml=a;var c=this.xml.getElementsByTagName("restriction")[0];c&&(this.base=this.xml.getElementsByTagName("restriction")[0].getAttribute("base")),this.length=this.xml.getElementsByTagName("length")[0]?this.xml.getElementsByTagName("length")[0].getAttribute("value"):0,this.minLength=this.xml.getElementsByTagName("minLength")[0]?this.xml.getElementsByTagName("minLength")[0].getAttribute("value"):0,this.maxLength=this.xml.getElementsByTagName("maxLength")[0]?this.xml.getElementsByTagName("maxLength")[0].getAttribute("value"):0,this.pattern=this.xml.getElementsByTagName("pattern")[0]?this.xml.getElementsByTagName("pattern")[0].getAttribute("value"):null,this.isNumber=function(){var a=!1,b=this.base,c=["byte","decimal","double","int","float","integer","long","negativeInteger","nonNegativeInteger","nonPositiveInteger","positiveInteger","short","unsignedLong","unsignedInt","unsignedShort","unsignedByte"];return c.some(function(c){if("xs:"+c===b)return a=!0,!0}),a},this.isNumber()&&(this.fractionDigits=this.xml.getElementsByTagName("fractionDigits")[0]?this.xml.getElementsByTagName("fractionDigits")[0].getAttribute("value"):null,this.maxInclusive=this.xml.getElementsByTagName("maxInclusive")[0]?this.xml.getElementsByTagName("maxInclusive")[0].getAttribute("value"):null,this.maxExclusive=this.xml.getElementsByTagName("maxExclusive")[0]?this.xml.getElementsByTagName("maxExclusive")[0].getAttribute("value"):null,this.minInclusive=this.xml.getElementsByTagName("minInclusive")[0]?this.xml.getElementsByTagName("minInclusive")[0].getAttribute("value"):null,this.minExclusive=this.xml.getElementsByTagName("minExclusive")[0]?this.xml.getElementsByTagName("minExclusive")[0].getAttribute("value"):null,this.totalDigits=this.xml.getElementsByTagName("totalDigits")[0]?this.xml.getElementsByTagName("totalDigits")[0].getAttribute("value"):null);var d=[];Array.prototype.slice.call(this.xml.getElementsByTagName("enumeration")).forEach(function(a){d.push(a.getAttribute("value"))}),this.enumeration=d,this.validate=function(a){function c(a){d.valid=!1,d.error=a}var d={valid:!0};if(this.enumeration.length>0){var e=!1;this.enumeration.forEach(function(b){if(a===b)return e=!0,!0}),e||c("Value of "+b+" does not match enumerated options.")}else this.isNumber()?/^[0-9.\-]*$/.test(a)?this.minInclusive&&parseFloat(a)<this.minInclusive?c("Value of "+b+" should be greater than "+this.minInclusive+" (inclusive)."):this.minExclusive&&parseFloat(a)<=this.minExclusive?c("Value of "+b+" should be greater than "+this.minExclusive+" (exclusive)."):this.maxInclusive&&parseFloat(a)>this.maxInclusive?c("Value of "+b+" should be less than "+this.maxInclusive+" (inclusive)."):this.maxExclusive&&parseFloat(a)>=this.maxExclusive?c("Value of "+b+" should be greater than "+this.maxExclusive+" (exclusive)."):this.totalDigits&&this.totalDigits!==a.replace(/\./,"").length?c("Value of "+b+" should be "+this.totalDigits+" digits."):this.fractionDigits&&this.fractionDigits<a.split(/\./)[1].length&&c("Value of "+b+" should have only "+this.fractionDigits+" digits past the decimal."):c("Value of "+b+" should be numeric."):"xs:string"===this.base&&(this.length>0&&a.length!==this.length?c("Value of "+b+" should be exactly "+this.length+"characters."):this.minLength>0&&a.length<this.minLength?c("Value of "+b+" should be at least "+this.minLength+"characters."):this.maxLength>0&&a.length>this.maxLength?c("Value of "+b+" exceeds "+this.maxLength+"characters."):this.pattern&&!new RegExp(this.pattern).test(a)&&c("Value of "+b+" does not match the specified pattern."));return d}}var xmlparser={parse:function(a){function b(a,b){if("undefined"!=typeof jQuery){try{c.doc=$.parseXML(a),c.str=a,c.parser="jQuery",b&&(c.uri=b)}catch(e){d.reject("XML could not be parsed.")}c.doc?d.resolve(c):d.reject("XML could not be parsed.")}else if("undefined"!=typeof DOMParser){var f=new DOMParser;c.doc=f.parseFromString(a,"application/xml"),c.str=a,c.parser="DOMParser",b&&(c.uri=b),c.doc.getElementsByTagName("parsererror").length>0?d.reject("XML could not be parsed."):d.resolve(c)}}var c={doc:null,str:null},d=xmlparser.deferred();if("object"==typeof a){if(a instanceof XMLDocument)c.doc=a,"undefined"!=typeof XMLSerializer&&(c.str=(new XMLSerializer).serializeToString(a)),d.resolve(c);else if("undefined"!=typeof jQuery&&a instanceof jQuery){var e=$(a.children()[0]).html(),f=a.children()[0].tagName,g="<"+f;$.each(a.children()[0].attributes,function(){g+=" "+this.name+'="'+this.value+'"'}),g+=">\n"+e+"\n<"+f+">",b(g),d.resolve(c)}}else if("string"==typeof a)if(/\.(xml|xsd)$/.test(a))if("undefined"!=typeof jQuery){var h=$.get(a,{},function(c){b(c,a)},"text");h["catch"](function(){d.reject("Could not read file: "+a)})}else{var i;if("undefined"!=typeof XMLHttpRequest)i=new XMLHttpRequest;else if("undefined"!=typeof ActiveXObject)try{i=new ActiveXObject("Msxml2.XMLHTTP")}catch(j){try{i=new ActiveXObject("Microsoft.XMLHTTP")}catch(k){i=null}}"undefined"!==i?(i.open("GET",a),i.setRequestHeader("Content-Type","application/xml"),i.onreadystatechange=function(){4===this.readyState&&(200===this.status?b(this.responseText,a):(c.error="Unable to request document, response code: "+this.status,d.reject(c)))},i.send(null)):(c.error="Unable to request document, browser does not support XMLHttpRequest and jQuery is not available.",d.reject(c))}else b(a);return d.promise()},deferred:function(){return"undefined"!=typeof jQuery?$.Deferred():"undefined"!=typeof Promise?function(){var a=null,b=null,c=new Promise(function(c,d){a=c,b=d});return{promise:function(){return c},resolve:a,reject:b}}():new function(){var a,b=!1,c=!1,d=[],e=[];this.resolve=function(c){b=!0,a=c,d.forEach(function(b){b(a)})},this.reject=function(b){c=!0,a=b,e.forEach(function(b){b(a)})},this.promise={then:function(c){return b?c(a):d.push(c),this},"catch":function(b){return c?b(a):e.push(b),this}}}}},xmlschema=function(a){function b(a,b){return Array.prototype.slice.call(a.getElementsByTagName(b),0)}function c(a,b,c){var d=[];a.childNodes.forEach(function(a){a.nodeType===Node.ELEMENT_NODE&&"xs:element"===a.tagName?d.push(k(a,b)):a.nodeType===Node.ELEMENT_NODE&&"xs:any"===a.tagName&&d.push(new e(a))}),this.id=a.getAttribute("id"),this.minOccurs=a.getAttribute("minOccurs")||1,this.maxOccurs=a.getAttribute("maxOccurs")||1,this.choices=d,this.number=y++,this.from="xs:choice",this.ns=c}function d(a,b,c,d){this.id=a.getAttribute("id"),this.name=a.getAttribute("name"),this.type=a.getAttribute("type"),this.minOccurs=a.getAttribute("minOccurs")||1,this.maxOccurs=function(){return a.getAttribute("maxOccurs")?a.getAttribute("maxOccurs"):c?"unbounded":1}(),b?this.xml=r[b].elem:this.xml=a.getElementsByTagName("simpleType")[0],this.validator=new XsSimpleTypeValidator(this.xml,"<"+a.getAttribute("name")+">"),this.from="xs:simpleType",this.ns=d}function e(a){this.minOccurs=a.getAttribute("minOccurs")||1,this.maxOccurs=a.getAttribute("maxOccurs")||1,this.from="xs:any",this.number=x++}function f(a){this.minOccurs=a.getAttribute("minOccurs")||1,this.maxOccurs=a.getAttribute("maxOccurs")||1,this.from="xs:anyAttribute",this.number=x++}function g(a,b,c){this.id=a.getAttribute("id"),this.name=a.getAttribute("name"),this.type=a.getAttribute("type"),this.minOccurs=a.getAttribute("minOccurs")||1,this.maxOccurs=function(){return a.getAttribute("maxOccurs")?a.getAttribute("maxOccurs"):b?"unbounded":1}(),this.from=a.getAttribute("type"),this.ns=c}function h(a,b,c,d){this.id=a.getAttribute("id"),this.name=a.getAttribute("name"),this.type=b,this.minOccurs=a.getAttribute("minOccurs")||1,this.maxOccurs=function(){return a.getAttribute("maxOccurs")?a.getAttribute("maxOccurs"):c?"unbounded":1}(),this.children=[],this.attributes=[],this.from="xs:complexType",b?this.xml=s[b].elem:this.xml=a.getElementsByTagName("complexType")[0],this.ns=d}function i(a){this.type=a.getAttribute("type"),this.name=a.getAttribute("name"),this.required=a.getAttribute("use")&&"required"===a.getAttribute("use"),this.prohibited=a.getAttribute("use")&&"prohibited"===a.getAttribute("use"),a.getAttribute("type")?this.xml=r[a.getAttribute("type")].elem:a.getElementsByTagName("simpleType")&&(this.xml=a.getElementsByTagName("simpleType")[0]),this.xml&&(this.validator=new XsSimpleTypeValidator(this.xml,"@"+a.getAttribute("name")))}function j(a,c){b(a,"anyAttribute").forEach(function(a){c.attributes.push(new f(a))}),b(a,"attribute").forEach(function(a){c.attributes.push(new i(a))})}function k(a,c,e){function f(a){var c=a.getElementsByTagName("sequence")[0],d=a.getElementsByTagName("all")[0],g=b(a,"group");g.forEach(function(a){f(u[a.getAttribute("ref")].elem)}),b(a,"attributeGroup").forEach(function(a){j(t[a.getAttribute("ref")].elem,i)});var h=a.getElementsByTagName("complexContent")[0];if(h){var k=h.getElementsByTagName("extension")[0].getAttribute("base"),m=s[k].elem||g[k].elem;f(m)}c?(i.sequence=!0,l(c,i.children,i.sequence,e)):d&&(i.sequence=!1,l(d,i.children,i.sequence,e)),j(a,i)}var i;Array.prototype.slice.call(a.getElementsByTagName("unique")).forEach(function(a){var b={name:a.getAttribute("name"),selector:a.getElementsByTagName("selector")[0].getAttribute("xpath"),field:a.getElementsByTagName("field")[0].getAttribute("xpath")};z.push(b)});var k,m;if(a.getAttribute("type"))if(a.getAttribute("type").indexOf(":")>-1){var n=a.getAttribute("type").split(/:/),o=n[0];m=v[o],k=n[1]}else k=a.getAttribute("type");return k&&r[k]||a.getElementsByTagName("simpleType").length>0?i=new d(a,k,c,e):k&&s[k]||a.getElementsByTagName("complexType").length>0?(i=new h(a,k,c,e),f(i.xml)):i=new g(a,c,e),i}function l(a,b,d,f){var g;a.childNodes.forEach(function(a){var h;a.nodeType===Node.ELEMENT_NODE&&"xs:element"===a.tagName?h=k(a,d,f):a.nodeType===Node.ELEMENT_NODE&&"xs:choice"===a.tagName?h=new c(a,d,f):a.nodeType===Node.ELEMENT_NODE&&"xs:any"===a.tagName&&(h=new e(a)),h&&(g&&(g.next=h),g=h,b.push(h))})}function m(a,b,c){var d=xmlparser.deferred(),e=[!1];return xmlparser.parse(a).then(function(a){function f(a,b,c){/^http/.test(a)?c(a):b?c(b.substring(0,b.lastIndexOf("/")+1)+a):A?A.then(function(){console.log(B);var b=B.doc.firstChild.getAttribute("schemaLocation").split(/[\r\n\s]+/)[1];c(b.substring(0,b.lastIndexOf("/")+1)+a)}):c()}function g(){var b=!0;for(var f in e)if(!e[f]){b=!1;break}b&&(c&&(l(a.doc.firstChild,w,!1,null),Array.prototype.slice.call(a.doc.firstChild.attributes).forEach(function(a){a.name.indexOf("xmlns:")>-1&&"xmlns:xs"!==a.name&&(v[a.name.replace(/^xmlns:/,"")]=a.value)})),d.resolve(a))}a.doc&&(a.doc.firstChild.childNodes.forEach(function(c){if(c.nodeType!==Node.ELEMENT_NODE||"xs:include"!==c.tagName&&"xs:import"!==c.tagName)c.nodeType===Node.ELEMENT_NODE&&"xs:simpleType"===c.tagName?r[c.getAttribute("name")]={elem:c,ns:b}:c.nodeType===Node.ELEMENT_NODE&&"xs:complexType"===c.tagName?s[c.getAttribute("name")]={elem:c,ns:b}:c.nodeType===Node.ELEMENT_NODE&&"xs:group"===c.tagName?u[c.getAttribute("name")]={elem:c,ns:b}:c.nodeType===Node.ELEMENT_NODE&&"xs:attributeGroup"===c.tagName&&(t[c.getAttribute("name")]={elem:c,ns:b});else{var h=e.length;e.push(!1),f(c.getAttribute("schemaLocation"),a.uri,function(a){if(a){var b="xs:import"===c.tagName?c.getAttribute("namespace"):null,f=m(a,b,!1);f.then(function(){e[h]=!0,g()})["catch"](function(){d.reject("Could not load include: "+c.getAttribute("schemaLocation"))})}else d.reject("Could not load include: "+c.getAttribute("schemaLocation"))})}}),e[0]=!0,g())})["catch"](function(){d.reject()}),d.promise()}function n(){q.then(function(a){p=a,xmlschemadocument=p.doc})}function o(a,b){function i(a){r.errors.push(a),console.log(a)}function j(){function a(a,b,c){return b+"defaultns:"+c}function b(a){return"defaultns"===a?B.doc.documentElement.getAttribute("xmlns"):void d(a)}var c=new XPathEvaluator,d=c.createNSResolver(B.doc.documentElement);z.forEach(function(d){for(var e=d.selector.replace(/^()([\w\-_:]+)/,a).replace(/(\/{1,2})([\w\-_:]+)/,a),f=c.evaluate(e,B.doc.documentElement,b,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),g={},h=0;h<f.snapshotLength;h++){var j=f.snapshotItem(h),k=d.field.replace(/^()([\w\-_:]+)/,a).replace(/(\/{1,2})([\w\-_:]+)/,a),l=c.evaluate(k,j,b,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);if(l.snapshotLength>0){var m=l.snapshotItem(0);g[m.nodeValue]?i("Unique constraint "+d.name+" violated on <"+j.tagName+">"):g[m.nodeValue]=!0}else warn("Could not evaluate unique constraint "+d.name+" on <"+j.tagName+"> field not found, xpath: "+d.field)}})}function k(a,b,j){function l(a){t[a]?t[a]++:t[a]=1,n=a}function m(b){i("Too many instances of <"+b.name+"> exceeding the maximum of "+b.maxOccurs+", parent element "+a[0].parentNode.tagName)}var n,p,q=[],s=[],t={};a.forEach(function(a){function k(b){if(o.elements++,l(a.tagName),p=b,b instanceof e)lastany=b.number;else if(b instanceof h){var c={};Array.prototype.slice.call(a.attributes).forEach(function(d){if(d.name.indexOf("xmlns")===-1&&d.name.indexOf("schemaLocation")===-1){var e=!1,g=!1;b.attributes.forEach(function(b){if(b instanceof f)g=!0;else if(d.name===b.name)if(o.attributes++,e=!0,c[d.name]=void 0!==c[d.name]?c[d.name]+1:1,b.prohibited)i("Attribute <"+a.tagName+" @"+d.name+"> is prohibited.");else if(void 0!==b.validator){var h=b.validator.validate(d.value);h.valid||i(h.error)}}),e||g||i("Unexpected attribute <"+a.tagName+" @"+d.name+">")}}),b.attributes.forEach(function(b){!c[b.name]&&b.required?i("Attribute is required <"+a.tagName+" @"+b.name+">"):c[b.name]>1&&i("Duplicate attribute <"+a.tagName+" @"+b.name+">")}),q.push({parent:a.tagName,nodes:a.childNodes,tree:b.children,sequence:b.sequence})}else if(b instanceof d&&a.firstChild){var j=b.validator.validate(a.firstChild.nodeValue);j.valid||i(j.error)}if((b instanceof d||b instanceof g)&&(!a.firstChild||!a.firstChild.nodeValue)){var k="Empty element <"+a.tagName+"> has no value.";r.warnings.push(k),console.warn(k)}return w=!0,!0}function m(b){function d(){b.choices.forEach(function(a){if(a.name===n)return x=!0,!0}),b.choices.forEach(function(b){if((!j||x||!n)&&a.tagName===b.name)return k(b),!0})}if(j?b instanceof c?d():b instanceof e&&lastany==b.number?x=!0:b.name===n?(x=!0,y++,y>t[b.name]&&k(b)):!x&&n||(!u&&b instanceof e&&(u=b),a.tagName===b.name?(k(b),u&&u.minOccurs>0&&i("An element not specified by the schema is required and did not match with an element in the XML document.")):(v.push(b.name),b.minOccurs>0&&s.push({element:a,expected:v}))):a.tagName===b.name?k(b):b instanceof c&&d(),w)return!0}if(a.nodeType===Node.ELEMENT_NODE){var u,v=[],w=!1;if(a.tagName===n)k(p);else{var x=!1,y=0;b.some(m),u&&k(u),w||i("Invalid element <"+a.tagName+"> not allowed, parent: "+a.parentNode.tagName)}}}),s.forEach(function(a){if(!j){var c=[];b.forEach(function(b){t[b.name]?b.maxOccurs>t[b.name]&&c.push(b.name):a.expected.push(b.name)}),0===a.expected.length&&(a.expected=c)}var d="Elements out of sequence, found <"+a.element.tagName+"> expected [",e=!0;a.expected.forEach(function(a){e||(d+=", "),d+=a,e=!1}),i(d+"], parent: "+a.element.parentNode.tagName)}),b.forEach(function(b){if(b instanceof c){var d,e=0;if(b.choices.forEach(function(a){t[a.name]&&(d||(d=a,e++))}),!d&&b.minOccurs>0){var f="Required choice not present, options: [",g=!0;b.choices.forEach(function(a){g||(f+=", "),f+=a.name,g=!1}),i(f+"].")}else if("unbounded"!==b.maxOccurs&&e>b.maxOccurs){var f="Too many choices selected from list: [",g=!0;b.choices.forEach(function(a){g||(f+=", "),f+=a.name,g=!1}),i(f+"] "+e+" options found, maximum is "+b.maxOccurs)}}else!t[b.name]&&b.minOccurs>0?i("Required element <"+b.name+"> missing, parent: "+a[0].parentNode.tagName):"unbounded"!==b.maxOccurs&&t[b.name]>b.maxOccurs&&m(b)}),q.forEach(function(a){k(a.nodes,a.tree,a.sequence)})}var l=xmlparser.deferred(),o={elements:0,attributes:0};b&&l.then(b);var r={errors:[],warnings:[],message:null,valid:!1};return A=xmlparser.parse(a).then(function(a){if(B=a,B.doc&&!q){var b;B.doc.firstChild.getAttribute("xsi:schemaLocation")?b=B.doc.firstChild.getAttribute("xsi:schemaLocation").split(/[\r\n\s]+/)[1]:B.doc.firstChild.getAttribute("xsi:noNamespaceSchemaLocation")&&(b=B.doc.firstChild.getAttribute("xsi:noNamespaceSchemaLocation")),b&&b.indexOf("http")>-1&&(console.log("Loading schema from document: "+b),q=m(b,null,!0),n())}return q?q.then(function(){p.doc?B.doc?(k(B.doc.childNodes,w,!0),j(),r.valid=0===r.errors.length,r.xml=B,r.xsd=p,r.message="Validated "+o.elements+" elements and "+o.attributes+" attributes, document is "+(r.valid?"valid":"invalid")+"."):(i("XML could not be parsed."),i(B.error)):(i("XSD could not be parsed."),i(p.error)),l.resolve(r)})["catch"](function(a){console.log(a),l.reject(a)}):l.reject("No schema document loaded."),r})["catch"](function(a){console.log(a),l.reject(a)}),l.promise()}var p,q,r={},s={},t={},u={},v={},w=[],x=0,y=0,z=[];a&&(q=m(a,null,!0),n());var A,B,C={validate:o,xmlparser:xmlparser};return"undefined"!=typeof xsdoptions&&(C.xsdoptions=xsdoptions),"undefined"!=typeof xmljson&&(C.xmljson=xmljson),C},xmlschemadocument;"undefined"!=typeof module&&(module.exports=xmlschema);