function XsSimpleTypeValidator(a,b){this.xml=a;var c=this.xml.getElementsByTagName("restriction")[0];c&&(this.base=this.xml.getElementsByTagName("restriction")[0].getAttribute("base")),this.length=this.xml.getElementsByTagName("length")[0]?this.xml.getElementsByTagName("length")[0].getAttribute("value"):0,this.minLength=this.xml.getElementsByTagName("minLength")[0]?this.xml.getElementsByTagName("minLength")[0].getAttribute("value"):0,this.maxLength=this.xml.getElementsByTagName("maxLength")[0]?this.xml.getElementsByTagName("maxLength")[0].getAttribute("value"):0,this.pattern=this.xml.getElementsByTagName("pattern")[0]?this.xml.getElementsByTagName("pattern")[0].getAttribute("value"):null,this.isNumber=function(){var a=!1,b=this.base,c=["byte","decimal","double","int","float","integer","long","negativeInteger","nonNegativeInteger","nonPositiveInteger","positiveInteger","short","unsignedLong","unsignedInt","unsignedShort","unsignedByte"];return c.some(function(c){if("xs:"+c===b)return a=!0,!0}),a},this.isNumber()&&(this.fractionDigits=this.xml.getElementsByTagName("fractionDigits")[0]?this.xml.getElementsByTagName("fractionDigits")[0].getAttribute("value"):null,this.maxInclusive=this.xml.getElementsByTagName("maxInclusive")[0]?this.xml.getElementsByTagName("maxInclusive")[0].getAttribute("value"):null,this.maxExclusive=this.xml.getElementsByTagName("maxExclusive")[0]?this.xml.getElementsByTagName("maxExclusive")[0].getAttribute("value"):null,this.minInclusive=this.xml.getElementsByTagName("minInclusive")[0]?this.xml.getElementsByTagName("minInclusive")[0].getAttribute("value"):null,this.minExclusive=this.xml.getElementsByTagName("minExclusive")[0]?this.xml.getElementsByTagName("minExclusive")[0].getAttribute("value"):null,this.totalDigits=this.xml.getElementsByTagName("totalDigits")[0]?this.xml.getElementsByTagName("totalDigits")[0].getAttribute("value"):null);var d=[];this.enumeration=d,Array.prototype.slice.call(this.xml.getElementsByTagName("enumeration")).forEach(function(a){d.push(a.getAttribute("value"))}),this.validate=function(a){function c(a){d.valid=!1,d.error=a}var d={valid:!0};if(this.enumeration.length>0){var e=!1;this.enumeration.forEach(function(a){if(a===a)return e=!0,!0}),e||c("Value of "+b+" does not match enumerated options.")}else this.isNumber()?/^[0-9.\-]*$/.test(a)?this.minInclusive&&parseFloat(a)<this.minInclusive?c("Value of "+b+" should be greater than "+this.minInclusive+" (inclusive)."):this.minExclusive&&parseFloat(a)<=this.minExclusive?c("Value of "+b+" should be greater than "+this.minExclusive+" (exclusive)."):this.maxInclusive&&parseFloat(a)>this.maxInclusive?c("Value of "+b+" should be less than "+this.maxInclusive+" (inclusive)."):this.maxExclusive&&parseFloat(a)>=this.maxExclusive?c("Value of "+b+" should be greater than "+this.maxExclusive+" (exclusive)."):this.totalDigits&&this.totalDigits!==a.replace(/\./,"").length?c("Value of "+b+" should be "+this.totalDigits+" digits."):this.fractionDigits&&this.fractionDigits<a.split(/\./)[1].length&&c("Value of "+b+" should have only "+this.fractionDigits+" digits past the decimal."):c("Value of "+b+" should be numeric."):"xs:string"===this.base&&(this.length>0&&a.length!==this.length?c("Value of "+b+" should be exactly "+this.length+"characters."):this.minLength>0&&a.length<this.minLength?c("Value of "+b+" should be at least "+this.minLength+"characters."):this.maxLength>0&&a.length>this.maxLength?c("Value of "+b+" exceeds "+this.maxLength+"characters."):this.pattern&&!new RegExp(this.pattern).test(a)&&c("Value of "+b+" does not match the specified pattern."));return d}}var xmlparser={parse:function(a){function b(a){if("undefined"!=typeof jQuery)c.doc=$.parseXML(a),c.str=a,c.doc?d.resolve(c):d.reject("XML was not parsed.");else if("undefined"!=typeof DOMParser)try{var b=new DOMParser;c.doc=b.parseFromString(a,"application/xml"),c.str=a,d.resolve(c)}catch(e){d.reject(e)}}var c={doc:null,str:null},d=xmlparser.deferred();if("object"==typeof a){if(a instanceof XMLDocument)c.doc=a,"undefined"!=typeof XMLSerializer&&(c.str=(new XMLSerializer).serializeToString(a)),d.resolve(c);else if("undefined"!=typeof jQuery&&a instanceof jQuery){var e=$(a.children()[0]).html(),f=a.children()[0].tagName,g="<"+f;$.each(a.children()[0].attributes,function(){g+=" "+this.name+'="'+this.value+'"'}),g+=">\n"+e+"\n<"+f+">",b(g),d.resolve(c)}}else if("string"==typeof a)if(/\.(xml|xsd)$/.test(a))if("undefined"!=typeof jQuery){var h=$.get(a,{},function(a){b(a)},"text");h["catch"](function(){d.reject("Could not read file: "+a)})}else{var i;if("undefined"!=typeof XMLHttpRequest)i=new XMLHttpRequest;else if("undefined"!=typeof ActiveXObject)try{i=new ActiveXObject("Msxml2.XMLHTTP")}catch(j){try{i=new ActiveXObject("Microsoft.XMLHTTP")}catch(k){i=null}}"undefined"!==i?(i.open("GET",a),i.setRequestHeader("Content-Type","application/xml"),i.onreadystatechange=function(){4===this.readyState&&(200===this.status?b(this.responseText):(c.error="Unable to request document, response code: "+this.status,d.reject(c)))},i.send(null)):(c.error="Unable to request document, browser does not support XMLHttpRequest and jQuery is not available.",d.reject(c))}else b(a);return d.promise()},deferred:function(){return"undefined"!=typeof jQuery?$.Deferred():"undefined"!=typeof Promise?function(){var a=null,b=null,c=new Promise(function(c,d){a=c,b=d});return{promise:function(){return c},resolve:a,reject:b}}():new function(){var a,b=!1,c=!1,d=[],e=[];this.resolve=function(c){b=!0,a=c,d.forEach(function(b){b(a)})},this.reject=function(b){c=!0,a=b,e.forEach(function(b){b(a)})},this.promise={then:function(c){return b?c(a):d.push(c),this},"catch":function(b){return c?b(a):e.push(b),this}}}}},xmljson={toXML:function(a){function b(a,c){var d="";for(var e in a)if("object"==typeof a[e]){if(a[e]instanceof Array)for(var f in a[e]){for(var g=0;g<c;g++)d+="\t";if(d+="<"+e+">","object"==typeof a[e][f]){d+="\n",d+=b(a[e][f],c+1);for(var g=0;g<c;g++)d+="\t"}else d+=a[e][f];d+="</"+e+">\n"}else if("value"===e&&void 0!==a.attributes)d+=a[e];else if("attributes"!==e){for(var g=0;g<c;g++)d+="\t";d+="<"+e;for(var h in a[e].attributes)d+=" "+h+'="'+a[e].attributes[h]+'"';var i=b(a[e],c+1);if(i){if(d+=">",i.indexOf("<")>-1&&(d+="\n"),d+=i,i.indexOf("<")>-1)for(var g=0;g<c;g++)d+="\t";d+="</"+e+">\n"}else d+=" />\n"}}else if("value"===e&&void 0!==a.attributes)d+=a[e];else{for(var g=0;g<c;g++)d+="\t";d+="<"+e+">"+a[e]+"</"+e+">\n"}return d}var c=a;return"string"==typeof c&&(c=JSON.parse(c)),b(c,0)},toJSON:function(a){function b(a){if("object"==typeof a){if(a instanceof XMLDocument)return a;if("undefined"!=typeof jQuery&&a instanceof jQuery){var c=$(a.children()[0]).html(),d=a.children()[0].tagName,e="<"+d;return $.each(a.children()[0].attributes,function(){e+=" "+this.name+'="'+this.value+'"'}),e+=">\n"+c+"\n<"+d+">",b(e)}}else if("string"==typeof a){if("undefined"!=typeof DOMParser){var f=new DOMParser;return f.parseFromString(a,"application/xml")}var g=new XMLDocument;return g.loadXML(a),g}}function c(a){var b=null,d=!1;if(a.attributes)for(var e=0;e<a.attributes.length;e++)b||(b={attributes:{}}),b.attributes[a.attributes[e].name]=a.attributes[e].value;return a.childNodes.forEach(function(a){a.nodeType===Node.ELEMENT_NODE&&(b||(b={}),void 0===b[a.tagName]||b[a.tagName]instanceof Array||(console.log("Array"),b[a.tagName]=[b[a.tagName]]),b[a.tagName]instanceof Array?b[a.tagName].push(c(a)):b[a.tagName]=c(a),d=!0)}),!d&&a.firstChild&&(b?b.value=a.firstChild.nodeValue:b=a.firstChild.nodeValue),b}var d=b(a);return c(d)}},xsdoptions=function(a){function b(a,b){Array.prototype.slice.call(document.querySelectorAll(a)).forEach(function(a){b(a)});var c=new MutationObserver(function(c){c.forEach(function(c){c.addedNodes.forEach(function(c){"undefined"!=typeof c.querySelectorAll&&Array.prototype.slice.call(c.querySelectorAll(a)).forEach(function(a){b(a)})})})}),d={attributes:!1,characterData:!1,childList:!0,subtree:!0};c.observe(document,d)}function c(a,b,c){if(!a.getElementsByTagName("option")||a.getElementsByTagName("option").length<=1){if(!a.getElementsByTagName("option")||0===a.getElementsByTagName("option").length){var d=document.createElement("option");d.appendChild(document.createTextNode("")),d.setAttribute("value",""),a.appendChild(d)}b.forEach(function(b){if(c){var d=a.innerHTML;d+=c(this),a.innerHTML=d}else{var e=document.createElement("option");e.appendChild(document.createTextNode(b.label)),e.setAttribute("value",b.value),a.appendChild(e)}})}}var d=[],e=xmlparser.deferred(),f=null,g={annotation:{value:function(a){if(f.doc){var b=null;return Array.prototype.slice.call(f.doc.querySelectorAll("simpleType,complexType")).some(function(c){if(c.getAttribute("name")===a)return b=c.getElementsByTagName("documentation")[0].firstChild.nodeValue,!0}),b}},property:function(a,b,c){Array.prototype.slice.call(document.querySelectorAll(a)).forEach(function(a){var d=g.annotation.value(c);a.setAttribute(b,d)})},data:function(a,b,c){if("undefined"!=typeof jQuery){var d=g.annotation.value(c);$(a).data(b,d)}},html:function(a,b){Array.prototype.slice.call(document.querySelectorAll(a)).forEach(function(a){var c=g.annotation.value(b);a.innerHTML=c})}},validate:function(a,b,c){var d=new XsSimpleTypeValidator(f.doc.querySelector("simpleType[name='"+b+"']"),c||b);return d.validate(a)},enumeration:function(a,b){return g.collection[a]&&!b?g.collection[a]:(g.collection[a]||(g.collection[a]=[]),f.doc&&(elem=f.doc.querySelector("simpleType[name='"+a+"']"),elem.getAttribute("name")===a&&Array.prototype.slice.call(elem.getElementsByTagName("enumeration")).forEach(function(b){var c=null;c=b.getElementsByTagName("documentation").length>0?b.getElementsByTagName("documentation")[0].firstChild.nodeValue:b.getAttribute("value"),g.collection[a].push({value:b.getAttribute("value"),label:c})})),console.log("Loaded "+g.collection[a].length+" enumerated options from simpleType: "+a),g.collection[a])},select:function(a,d,e){g.enumeration(d),b(a,function(a){var b=g.enumeration(d);c(a,b,e)})},collection:d,ready:e,xsd:f};if(a){var h=xmlparser.parse(a);h.then(function(a){f=a,e.resolve(g)}),h["catch"](function(a){e.reject(a)})}else"undefined"!=typeof xmlschema&&"undefined"!=typeof xmlschemadocument?(f=xmlschemadocument,e.resolve(g)):e.reject("No xsd was provided. usage: xsdoptions(xsd);");return e.promise()},xmlschema=function(a){function b(a,b){return Array.prototype.slice.call(a.getElementsByTagName(b),0)}function c(a,b){var c=[];a.childNodes.forEach(function(a){a.nodeType===Node.ELEMENT_NODE&&"xs:element"===a.tagName?c.push(k(a,b)):a.nodeType===Node.ELEMENT_NODE&&"xs:any"===a.tagName&&c.push(new e(a))}),this.id=a.getAttribute("id"),this.minOccurs=a.getAttribute("minOccurs")||1,this.maxOccurs=a.getAttribute("maxOccurs")||1,this.choices=c,this.number=w++,this.from="xs:choice"}function d(a,b,c){this.id=a.getAttribute("id"),this.name=a.getAttribute("name"),this.type=a.getAttribute("type"),this.minOccurs=a.getAttribute("minOccurs")||1,this.maxOccurs=function(){return a.getAttribute("maxOccurs")?a.getAttribute("maxOccurs"):b?"unbounded":1}(),a.getAttribute("type")?this.xml=q[a.getAttribute("type")]:c&&(this.xml=c),this.validator=new XsSimpleTypeValidator(this.xml,"<"+a.getAttribute("name")+">"),this.from="xs:simpleType"}function e(a){this.minOccurs=a.getAttribute("minOccurs")||1,this.maxOccurs=a.getAttribute("maxOccurs")||1,this.from="xs:any",this.number=v++}function f(a){this.minOccurs=a.getAttribute("minOccurs")||1,this.maxOccurs=a.getAttribute("maxOccurs")||1,this.from="xs:anyAttribute",this.number=v++}function g(a,b){this.id=a.getAttribute("id"),this.name=a.getAttribute("name"),this.type=a.getAttribute("type"),this.minOccurs=a.getAttribute("minOccurs")||1,this.maxOccurs=function(){return a.getAttribute("maxOccurs")?a.getAttribute("maxOccurs"):b?"unbounded":1}(),this.from=a.getAttribute("type")}function h(a,b,c){this.id=a.getAttribute("id"),this.name=a.getAttribute("name"),this.type=a.getAttribute("type"),this.minOccurs=a.getAttribute("minOccurs")||1,this.maxOccurs=function(){return a.getAttribute("maxOccurs")?a.getAttribute("maxOccurs"):b?"unbounded":1}(),this.children=[],this.attributes=[],this.from="xs:complexType",a.getAttribute("type")?this.xml=r[a.getAttribute("type")]:c&&(this.xml=c)}function i(a){this.type=a.getAttribute("type"),this.name=a.getAttribute("name"),this.required=a.getAttribute("use")&&"required"===a.getAttribute("use"),this.prohibited=a.getAttribute("use")&&"prohibited"===a.getAttribute("use"),a.getAttribute("type")?this.xml=q[a.getAttribute("type")]:a.getElementsByTagName("simpleType")&&(this.xml=a.getElementsByTagName("simpleType")[0]),this.xml&&(this.validator=new XsSimpleTypeValidator(this.xml,"@"+a.getAttribute("name")))}function j(a,c){b(a,"anyAttribute").forEach(function(a){c.attributes.push(new f(a))}),b(a,"attribute").forEach(function(a){c.attributes.push(new i(a))})}function k(a,c){function e(a){var c=a.getElementsByTagName("sequence")[0],d=a.getElementsByTagName("all")[0],g=b(a,"group");g.forEach(function(a){e(t[a.getAttribute("ref")])}),b(a,"attributeGroup").forEach(function(a){j(s[a.getAttribute("ref")],f)});var h=a.getElementsByTagName("complexContent")[0];if(h){var i=h.getElementsByTagName("extension")[0].getAttribute("base"),k=r[i]||g[i];e(k)}c?(f.sequence=!0,l(c,f.children,f.sequence)):d&&(f.sequence=!1,l(d,f.children,f.sequence)),j(a,f)}var f,i=a.getElementsByTagName("simpleType"),k=a.getElementsByTagName("complexType");return a.getAttribute("type")&&q[a.getAttribute("type")]?f=new d(a,c):i.length>0?f=new d(a,c,i[0]):r[a.getAttribute("type")]||k.length>0?(f=new h(a,c,k[0]),e(f.xml)):f=new g(a,c),f}function l(a,b,d){var f;a.childNodes.forEach(function(a){var g;a.nodeType===Node.ELEMENT_NODE&&"xs:element"===a.tagName?g=k(a,d):a.nodeType===Node.ELEMENT_NODE&&"xs:choice"===a.tagName?g=new c(a,d):a.nodeType===Node.ELEMENT_NODE&&"xs:any"===a.tagName&&(g=new e(a)),g&&(f&&(f.next=g),f=g,b.push(g))})}function m(a){return xmlparser.parse(a).then(function(a){o=a,o.doc&&(xmlschemadocument=o.doc,o.doc.firstChild.childNodes.forEach(function(a){a.nodeType===Node.ELEMENT_NODE&&"xs:simpleType"===a.tagName?q[a.getAttribute("name")]=a:a.nodeType===Node.ELEMENT_NODE&&"xs:complexType"===a.tagName?r[a.getAttribute("name")]=a:a.nodeType===Node.ELEMENT_NODE&&"xs:group"===a.tagName?t[a.getAttribute("name")]=a:a.nodeType===Node.ELEMENT_NODE&&"xs:attributeGroup"===a.tagName&&(s[a.getAttribute("name")]=a)}),l(o.doc.firstChild,u,!1))})}function n(a,b){function i(a){n.errors.push(a),console.log(a)}function j(a,b,k){function l(a){s[a]?s[a]++:s[a]=1,o=a}function m(b){i("Too many instances of <"+b.name+"> exceeding the maximum of "+b.maxOccurs+", parent element "+a[0].parentNode.tagName)}var o,p,q=[],r=[],s={};a.forEach(function(a){function j(b){if(l(a.tagName),p=b,b instanceof e)lastany=b.number;else if(b instanceof h){var c={};Array.prototype.slice.call(a.attributes).forEach(function(d){if(d.name.indexOf("xmlns")===-1&&d.name.indexOf("schemaLocation")===-1){var e=!1,g=!1;b.attributes.forEach(function(b){if(b instanceof f)g=!0;else if(d.name===b.name)if(e=!0,c[d.name]=void 0!==c[d.name]?c[d.name]+1:1,b.prohibited)i("Attribute <"+a.tagName+" @"+d.name+"> is prohibited.");else if(void 0!==b.validator){var h=b.validator.validate(d.value);h.valid||i(h.error)}}),e||g||i("Unexpected attribute <"+a.tagName+" @"+d.name+">")}}),b.attributes.forEach(function(b){!c[b.name]&&b.required?i("Attribute is required <"+a.tagName+" @"+b.name+">"):c[b.name]>1&&i("Duplicate attribute <"+a.tagName+" @"+b.name+">")}),q.push({parent:a.tagName,nodes:a.childNodes,tree:b.children,sequence:b.sequence})}else if(b instanceof d&&a.firstChild){var j=b.validator.validate(a.firstChild.nodeValue);j.valid||i(j.error)}if((b instanceof d||b instanceof g)&&(!a.firstChild||!a.firstChild.nodeValue)){var k="Empty element <"+a.tagName+"> has no value.";n.warnings.push(k),console.warn(k)}return v=!0,!0}function m(b){function d(){b.choices.forEach(function(a){if(a.name===o)return w=!0,!0}),b.choices.forEach(function(b){if((!k||w||!o)&&a.tagName===b.name)return j(b),!0})}if(k?b instanceof c?d():b instanceof e&&lastany==b.number?w=!0:b.name===o?(w=!0,x++,x>s[b.name]&&j(b)):!w&&o||(!t&&b instanceof e&&(t=b),a.tagName===b.name?(j(b),t&&t.minOccurs>0&&i("An element not specified by the schema is required and did not match with an element in the XML document.")):(u.push(b.name),b.minOccurs>0&&r.push({element:a,expected:u}))):a.tagName===b.name?j(b):b instanceof c&&d(),v)return!0}if(a.nodeType===Node.ELEMENT_NODE){var t,u=[],v=!1;if(a.tagName===o)j(p);else{var w=!1,x=0;b.some(m),t&&j(t),v||i("Invalid element <"+a.tagName+"> not allowed, parent: "+a.parentNode.tagName)}}}),r.forEach(function(a){if(!k){var c=[];b.forEach(function(b){s[b.name]?b.maxOccurs>s[b.name]&&c.push(b.name):a.expected.push(b.name)}),0===a.expected.length&&(a.expected=c)}var d="Elements out of sequence, found <"+a.element.tagName+"> expected [",e=!0;a.expected.forEach(function(a){e||(d+=", "),d+=a,e=!1}),i(d+"], parent: "+a.element.parentNode.tagName)}),b.forEach(function(b){if(b instanceof c){var d,e=0;if(b.choices.forEach(function(a){s[a.name]&&(d||(d=a,e++))}),!d&&b.minOccurs>0){var f="Required choice not present, options: [",g=!0;b.choices.forEach(function(a){g||(f+=", "),f+=a.name,g=!1}),i(f+"].")}else if("unbounded"!==b.maxOccurs&&e>b.maxOccurs){var f="Too many choices selected from list: [",g=!0;b.choices.forEach(function(a){g||(f+=", "),f+=a.name,g=!1}),i(f+"] "+e+" options found, maximum is "+b.maxOccurs)}}else!s[b.name]&&b.minOccurs>0?i("Required element <"+b.name+"> missing, parent: "+a[0].parentNode.tagName):"unbounded"!==b.maxOccurs&&s[b.name]>b.maxOccurs&&m(b)}),q.forEach(function(a){j(a.nodes,a.tree,a.sequence)})}var k,l=xmlparser.deferred();b&&l.then(b);var n={errors:[],warnings:[],message:null,valid:!1};return xmlparser.parse(a).then(function(a){if(k=a,k.doc&&!o){var b;k.doc.firstChild.getAttribute("xsi:schemaLocation")?b=k.doc.firstChild.getAttribute("xsi:schemaLocation").split(/[\r\n\s]+/)[1]:k.doc.firstChild.getAttribute("xsi:noNamespaceSchemaLocation")&&(b=k.doc.firstChild.getAttribute("xsi:noNamespaceSchemaLocation")),b&&b.indexOf("http")>-1&&(console.log("Loading schema from document: "+b),p=m(b))}return p?p.then(function(){o.doc?k.doc?(j(k.doc.childNodes,u,!0),n.valid=0===n.errors.length,n.xml=k,n.xsd=o):(i("XML could not be parsed."),i(k.error)):(i("XSD could not be parsed."),i(o.error)),l.resolve(n)}):i("No schema document loaded."),n}),l.promise()}var o,p,q={},r={},s={},t={},u=[],v=0,w=0;a&&(p=m(a));var x={validate:n,xmlparser:xmlparser};return"undefined"!=typeof xsdoptions&&(x.xsdoptions=xsdoptions),"undefined"!=typeof xmljson&&(x.xmljson=xmljson),x},xmlschemadocument;"undefined"!=typeof module&&(module.exports=xmlschema);